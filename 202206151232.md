---
tags: [networking]
---

# Transmission Control Protocol (TCP)

TCP is a commonly used [Protocol](202209302229.md)# in
#[Internet Protocol Suite (TCP/IP)](202206151238.md) defined by RFC 793, RFC
1122, RFC 1323, RFC 2018, and RFC 2581. It is a #[Transport Layer](202206131837.md)
protocol according to the classification of #[Open Systems Interconnection (OSI) Model](202206131632.md).
It provides reliable data transfer, flow control (so that one channel doesn't
overflow the other), and congestion control. In addition, it also provides
byte-stream abstraction where there is no need to know how the byte stream will
reach to the destination. The demultiplexing of the TCP (delivering of packets
to corresponding [socket](202202172152.md)) is based on the source and
destination [IP Address](202206281021.md) and [port numbers](202206151841.md).

TCP is designed to be *connection-oriented* and *reliable*, in contrast to
[User Datagram Protocol (UDP)](202206151759.md). This means that connection must
be established first (using **three-way handshake**) via a full-duplex channel
point-to-point and maintained by the protocol during a transmission. Because of
this nature, TCP doesn't allow multicasting. The requester will first send out a
control bit SYN (stand for synchronisation) and its Initial Sequence Number
(ISN) to the server. The server sends back a packet to the requester that
contains the control bit ACK (stand for acknowledgement) and its ISN. From now
on, the requester will assume the connection is well established, and it will
send packets, may include data (limited by [maximum segment size](202303282019.md)),
to the server with incremented SYN and ACK (same to the server). This way, TCP
can guarantee the eventual orderly delivery of the packets.

It breaks messages into **segments** (its [Protocol Data Units (PDU)](202206131643.md)#)
and reassemble at the destination. If there is a failure on sending such
messages, TCP will resend it. It also provides virtual circuits between
application. At the end, the connection will be torn down if there is no need
for it.

The header of a TCP segment include the following information:
- source port number (16 bits)
- destination port number (16 bits)
- sequence number (32 bits, the byte-stream number of the first byte in TCP
  segment, depending on MSS, it is initialised in a random number)
- [acknowledgement](202303141902.md) number (32 bits, the first missing stream
  byte or next expected byte)
- header length (4 bits, depends on the option field)
- flag (6 bits, including ACK, RST [reset], SYN [setup], FIN [teardown], PSH
  [immediately passing data to the upper layer], URG [mark the packet as urgent
  indicated by upper layer, the last byte is defined by urgent data pointer])
- receive window (16 bits, defines number of bytes the receiver willing to
  accept, useful for [Flow Control](202209302245.md))
- Internet checksum
- Urgent data pointer
- option (variable length, defined by RFC 854 and 1323, use to negotiate MSS,
  define window scaling factor, time-stamping etc)

To improve the performance, the overhead of the connection tunnel must be
addressed. This could be done by **windowing**, a method where the device sends
[ACK](202303141902.md) (without timeout) only when it has received enough
packets. The consensus about the size of window can be reached after the server
send back an ACK packet with the information of the window size that it can
achieve (usually after a packet has failed to be sent to the server).
Furthermore, it has an additional benefit of handling the edge case where the
sender could send too much, too fast which could overflow the receiver's buffer.
The timeout is typically larger than [Round-Trip Time (RTT)](202303292133.md) to
avoid unnecessary retransmissions of acknowledged packets so that there will be
no large amount of packets reside in the [pipeline](202303141909.md). Usually,
the timeout will be doubled to act as a limited congestion control. It will be
[calculated](202303292133.md) once again when the timer is started after data is
received from the application above or the acknowledgement is received.

When facing [Network Congestion](202209302043.md), there is a throttling
mechanism that limit the transmission rate to save bandwidth. It is one of the
reason real time communication always perform badly in TCP especially when there
is not enough bandwidth available.

Examples of TCP:
- [Diameter](202210221333.md)#
- [Simple Mail Transfer Protocol (SMTP)](202302251327.md)
- Telnet
- [Hypertext Transfer Protocol (HTTP)](202202211439.md)
- [File Transfer Protocol (FTP)](202210221515.md)
- [Network File System (NFS)](202302131659.md)
